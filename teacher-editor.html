<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2518ç­çº§å‘¨æŠ¥ - æ•™å¸ˆç¼–è¾‘ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #1e3c72;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1.5rem;
        }
        
        .editor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .editor-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .editor-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 1rem;
        }
        
        .editor-header h3 {
            font-size: 1.5rem;
            color: #1e3c72;
            margin-left: 1rem;
        }
        
        .icon {
            font-size: 2rem;
            color: #667eea;
        }
        
        .editor-content {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        
        .content-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }
        
        .content-item h4 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .content-item p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }
        
        .meta {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }
        
        .tags {
            margin-top: 0.5rem;
        }
        
        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.2rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .editor-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .share-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .share-section h2 {
            color: #1e3c72;
            margin-bottom: 1rem;
        }
        
        .share-link {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 1.1rem;
            word-break: break-all;
        }
        
        .copy-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }
        
        .copy-btn:hover {
            background: #138496;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(300px);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 768px) {
            .editor-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
            <h1>2518ç­çº§å­¦æœ¯å‘¨æŠ¥</h1>
            <p>æ•™å¸ˆç¼–è¾‘ç‰ˆ - ä¸€é”®ç¼–è¾‘ï¼Œå³æ—¶åˆ†äº«</p>
            <div class="welcome-stats">
                <div class="stat-item">
                    <span class="stat-number" id="notesCount">0</span>
                    <span class="stat-label">ç¯‡å¿ƒå¾—åˆ†äº«</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="newsCount">0</span>
                    <span class="stat-label">æ¡æ³•å­¦åŠ¨æ€</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="literatureCount">0</span>
                    <span class="stat-label">æœ¬æ¨èæ–‡çŒ®</span>
                </div>
            </div>
        </div>

        <!-- ç¼–è¾‘åŒºåŸŸ -->
        <div class="editor-grid">
            <!-- è¯»åæ„Ÿç¼–è¾‘ -->
            <div class="editor-card">
                <div class="editor-header">
                    <div class="icon">ğŸ“š</div>
                    <h3>è¯»åæ„Ÿ/è§‚åæ„Ÿ</h3>
                </div>
                <div class="editor-content" id="readingNotesContent">
                    <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="editor-form">
                    <div class="form-group">
                        <label for="readingTitle">æ ‡é¢˜</label>
                        <input type="text" id="readingTitle" class="form-control" placeholder="è¯·è¾“å…¥æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="readingAuthor">ä½œè€…</label>
                        <input type="text" id="readingAuthor" class="form-control" placeholder="è¯·è¾“å…¥ä½œè€…å§“å">
                    </div>
                    <div class="form-group">
                        <label for="readingContent">å†…å®¹</label>
                        <textarea id="readingContent" class="form-control" rows="3" placeholder="è¯·åˆ†äº«é˜…è¯»æˆ–è§‚å½±å¿ƒå¾—..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addReadingNote()">æ·»åŠ å¿ƒå¾—</button>
                        <button class="btn btn-secondary" onclick="clearReadingForm()">æ¸…ç©º</button>
                    </div>
                </div>
            </div>

            <!-- æ³•å­¦åŠ¨æ€ç¼–è¾‘ -->
            <div class="editor-card">
                <div class="editor-header">
                    <div class="icon">ğŸ“°</div>
                    <h3>æ³•å­¦åŠ¨æ€é€Ÿé€’</h3>
                </div>
                <div class="editor-content" id="lawNewsContent">
                    <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="editor-form">
                    <div class="form-group">
                        <label for="newsTitle">æ ‡é¢˜</label>
                        <input type="text" id="newsTitle" class="form-control" placeholder="è¯·è¾“å…¥æ–°é—»æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="newsSource">æ¥æº</label>
                        <input type="text" id="newsSource" class="form-control" placeholder="è¯·è¾“å…¥æ–°é—»æ¥æº">
                    </div>
                    <div class="form-group">
                        <label for="newsContent">å†…å®¹</label>
                        <textarea id="newsContent" class="form-control" rows="3" placeholder="è¯·è¾“å…¥æ–°é—»å†…å®¹..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addLawNews()">æ·»åŠ åŠ¨æ€</button>
                        <button class="btn btn-secondary" onclick="clearNewsForm()">æ¸…ç©º</button>
                    </div>
                </div>
            </div>

            <!-- æ–‡çŒ®æ¨èç¼–è¾‘ -->
            <div class="editor-card">
                <div class="editor-header">
                    <div class="icon">ğŸ“–</div>
                    <h3>æ–‡çŒ®æ¨è</h3>
                </div>
                <div class="editor-content" id="literatureContent">
                    <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="editor-form">
                    <div class="form-group">
                        <label for="litTitle">ä¹¦å</label>
                        <input type="text" id="litTitle" class="form-control" placeholder="è¯·è¾“å…¥ä¹¦å">
                    </div>
                    <div class="form-group">
                        <label for="litAuthor">ä½œè€…</label>
                        <input type="text" id="litAuthor" class="form-control" placeholder="è¯·è¾“å…¥ä½œè€…">
                    </div>
                    <div class="form-group">
                        <label for="litPublisher">å‡ºç‰ˆç¤¾</label>
                        <input type="text" id="litPublisher" class="form-control" placeholder="è¯·è¾“å…¥å‡ºç‰ˆç¤¾">
                    </div>
                    <div class="form-group">
                        <label for="litSummary">å†…å®¹ç®€ä»‹</label>
                        <textarea id="litSummary" class="form-control" rows="3" placeholder="è¯·è¾“å…¥å†…å®¹ç®€ä»‹..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addLiterature()">æ·»åŠ æ–‡çŒ®</button>
                        <button class="btn btn-secondary" onclick="clearLiteratureForm()">æ¸…ç©º</button>
                    </div>
                </div>
            </div>

            <!-- å­¦æœ¯æ²™é¾™ç¼–è¾‘ -->
            <div class="editor-card">
                <div class="editor-header">
                    <div class="icon">ğŸ¯</div>
                    <h3>å­¦æœ¯æ²™é¾™æ´»åŠ¨</h3>
                </div>
                <div class="editor-content" id="salonContent">
                    <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="editor-form">
                    <div class="form-group">
                        <label for="eventTitle">æ´»åŠ¨æ ‡é¢˜</label>
                        <input type="text" id="eventTitle" class="form-control" placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="eventDate">æ—¥æœŸ</label>
                        <input type="date" id="eventDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="eventSpeaker">ä¸»è®²äºº</label>
                        <input type="text" id="eventSpeaker" class="form-control" placeholder="è¯·è¾“å…¥ä¸»è®²äºº">
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">æ´»åŠ¨æè¿°</label>
                        <textarea id="eventDescription" class="form-control" rows="3" placeholder="è¯·è¾“å…¥æ´»åŠ¨æè¿°..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="addSalonEvent()">æ·»åŠ æ´»åŠ¨</button>
                        <button class="btn btn-secondary" onclick="clearEventForm()">æ¸…ç©º</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GitHub Gisté…ç½®åŒºåŸŸ -->
        <div class="share-section">
            <h2>ğŸ”§ GitHub Gisté…ç½®</h2>
            <p>é…ç½®GitHub Gistä»¥å®ç°æ•°æ®åŒæ­¥ï¼ˆæ•™å¸ˆç¼–è¾‘åå­¦ç”Ÿç«‹å³å¯è§ï¼‰</p>
            
            <div class="form-group">
                <label for="gistId">Gist IDï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="gistId" class="form-control" placeholder="ç²˜è´´æ‚¨çš„Gist IDï¼Œç•™ç©ºå°†è‡ªåŠ¨åˆ›å»º">
            </div>
            
            <div class="form-group">
                <label for="githubToken">GitHub Tokenï¼ˆå¯é€‰ï¼‰</label>
                <input type="password" id="githubToken" class="form-control" placeholder="ç²˜è´´æ‚¨çš„GitHub Tokenï¼Œç”¨äºåˆ›å»ºç§æœ‰Gist">
            </div>
            
            <div style="margin: 1rem 0;">
                <button class="btn btn-primary" onclick="configureGist()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="createNewGist()">ğŸ†• åˆ›å»ºæ–°Gist</button>
                <button class="btn btn-success" onclick="testGistConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
            </div>
            
            <div id="gistStatus" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; background: #f8f9fa;"></div>
        </div>

        <!-- åˆ†äº«åŒºåŸŸ -->
        <div class="share-section">
            <h2>ğŸ“¤ åˆ†äº«ç»™å­¦ç”Ÿ</h2>
            <p>é…ç½®å®Œæˆåï¼Œå¤åˆ¶ä¸‹æ–¹é“¾æ¥åˆ†äº«ç»™å­¦ç”Ÿå³å¯</p>
            <div class="share-link" id="shareLink">
                http://your-share-link.here
            </div>
            <div>
                <button class="copy-btn" onclick="copyShareLink()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                <button class="btn btn-success" onclick="generateShareLink()">ğŸ”„ æ›´æ–°é“¾æ¥</button>
            </div>
            <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                å­¦ç”Ÿåªéœ€ç‚¹å‡»é“¾æ¥å³å¯æŸ¥çœ‹æœ€æ–°å†…å®¹ï¼Œæ— éœ€ç™»å½•
            </p>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div class="notification" id="notification">æ“ä½œæˆåŠŸï¼</div>

    <script>
        // GitHub Gisté…ç½®
        let gistConfig = {
            gistId: '',
            githubToken: '',
            isPublic: true
        };

        // æ•°æ®å­˜å‚¨
        let appData = {
            readingNotes: [],
            lawNews: [],
            literature: [],
            salonEvents: [],
            lastUpdate: new Date().toISOString()
        };

        // åŠ è½½Gisté…ç½®
        function loadGistConfig() {
            const savedConfig = localStorage.getItem('gistConfig');
            if (savedConfig) {
                gistConfig = JSON.parse(savedConfig);
                document.getElementById('gistId').value = gistConfig.gistId || '';
                document.getElementById('githubToken').value = gistConfig.githubToken || '';
            }
        }

        // ä¿å­˜Gisté…ç½®
        function saveGistConfig() {
            localStorage.setItem('gistConfig', JSON.stringify(gistConfig));
        }

        // åˆå§‹åŒ–æ•°æ®
        async function initData() {
            // åŠ è½½Gisté…ç½®
            loadGistConfig();
            
            // é¦–å…ˆå°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®ï¼Œç¡®ä¿æœ‰åŸºç¡€æ•°æ®
            const savedData = localStorage.getItem('class2518WeeklyData');
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                // é»˜è®¤ç¤ºä¾‹æ•°æ®
                appData = {
                    readingNotes: [
                        {
                            id: 1,
                            title: 'ã€Šæ³•æ²»çš„ç»†èŠ‚ã€‹è¯»åæ„Ÿ',
                            author: 'å¼ ä¸‰',
                            content: 'é€šè¿‡é˜…è¯»ç½—ç¿”è€å¸ˆçš„ã€Šæ³•æ²»çš„ç»†èŠ‚ã€‹ï¼Œæˆ‘å¯¹æ³•å¾‹ä¸é“å¾·çš„å…³ç³»æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£...',
                            date: new Date().toISOString().split('T')[0]
                        }
                    ],
                    lawNews: [
                        {
                            id: 1,
                            title: 'æœ€é«˜æ³•å‘å¸ƒæœ€æ–°å¸æ³•è§£é‡Š',
                            source: 'æœ€é«˜äººæ°‘æ³•é™¢',
                            content: 'æœ€é«˜äººæ°‘æ³•é™¢è¿‘æ—¥å‘å¸ƒå…³äºæ°‘é—´å€Ÿè´·çº çº·æ¡ˆä»¶å®¡ç†çš„å¸æ³•è§£é‡Š...',
                            date: new Date().toISOString().split('T')[0]
                        }
                    ],
                    literature: [
                        {
                            id: 1,
                            title: 'ã€Šæ³•ç†å­¦ã€‹',
                            author: 'å¼ æ–‡æ˜¾',
                            publisher: 'é«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾',
                            summary: 'ç³»ç»Ÿé˜è¿°æ³•ç†å­¦åŸºæœ¬ç†è®ºï¼Œé€‚åˆæ³•å­¦ä¸“ä¸šå­¦ç”Ÿé˜…è¯»...'
                        }
                    ],
                    salonEvents: [
                        {
                            id: 1,
                            title: 'AIä¸æ³•å¾‹ä¼¦ç†ç ”è®¨ä¼š',
                            date: '2024-01-20',
                            speaker: 'ç‹æ•™æˆ',
                            description: 'æ¢è®¨äººå·¥æ™ºèƒ½å‘å±•å¯¹æ³•å¾‹ä¼¦ç†çš„æŒ‘æˆ˜ä¸åº”å¯¹'
                        }
                    ],
                    lastUpdate: new Date().toISOString()
                };
                saveData();
            }
            
            // å¦‚æœé…ç½®äº†Gistï¼Œä»GiståŠ è½½æœ€æ–°æ•°æ®ï¼ˆä½†ä¿ç•™æœ¬åœ°æ•°æ®ä½œä¸ºå¤‡ä»½ï¼‰
            if (gistConfig.gistId) {
                await loadDataFromGist();
            }
            
            updateUI();
        }

        // ä¿å­˜æ•°æ®
        async function saveData() {
            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            appData.lastUpdate = new Date().toISOString();
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('class2518WeeklyData', JSON.stringify(appData));
            
            // å¦‚æœé…ç½®äº†Gistï¼ŒåŒæ­¥åˆ°GitHub Gist
            if (gistConfig.gistId) {
                await saveDataToGist();
            }
        }

        // GitHub Gistç›¸å…³åŠŸèƒ½
        // é…ç½®Gist
        function configureGist() {
            const gistId = document.getElementById('gistId').value.trim();
            const githubToken = document.getElementById('githubToken').value.trim();
            
            if (gistId) {
                gistConfig.gistId = gistId;
            }
            
            if (githubToken) {
                gistConfig.githubToken = githubToken;
            }
            
            saveGistConfig();
            showNotification('Gisté…ç½®å·²ä¿å­˜ï¼');
            updateGistStatus('é…ç½®å·²ä¿å­˜ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨GiståŒæ­¥åŠŸèƒ½');
        }

        // åˆ›å»ºæ–°Gist
        async function createNewGist() {
            const githubToken = document.getElementById('githubToken').value.trim();
            
            if (!githubToken) {
                showNotification('è¯·å…ˆè¾“å…¥GitHub Token');
                return;
            }
            
            try {
                updateGistStatus('æ­£åœ¨åˆ›å»ºæ–°çš„Gist...');
                
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: '2518ç­çº§å‘¨æŠ¥æ•°æ®åŒæ­¥',
                        public: false,
                        files: {
                            'class2518-data.json': {
                                content: JSON.stringify(appData, null, 2)
                            }
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    gistConfig.gistId = result.id;
                    document.getElementById('gistId').value = result.id;
                    saveGistConfig();
                    updateGistStatus(`Giståˆ›å»ºæˆåŠŸï¼ID: ${result.id}`);
                    showNotification('æ–°Giståˆ›å»ºæˆåŠŸï¼');
                } else {
                    throw new Error(`åˆ›å»ºå¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.error('åˆ›å»ºGistå¤±è´¥:', error);
                updateGistStatus(`åˆ›å»ºå¤±è´¥: ${error.message}`);
                showNotification('Giståˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥Token');
            }
        }

        // æµ‹è¯•Gistè¿æ¥
        async function testGistConnection() {
            if (!gistConfig.gistId) {
                showNotification('è¯·å…ˆé…ç½®Gist ID');
                return;
            }
            
            try {
                updateGistStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...');
                
                const response = await fetch(`https://api.github.com/gists/${gistConfig.gistId}`);
                
                if (response.ok) {
                    updateGistStatus('è¿æ¥æµ‹è¯•æˆåŠŸï¼');
                    showNotification('Gistè¿æ¥æµ‹è¯•æˆåŠŸ');
                } else {
                    throw new Error(`è¿æ¥å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.error('æµ‹è¯•è¿æ¥å¤±è´¥:', error);
                updateGistStatus(`è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`);
                showNotification('Gistè¿æ¥æµ‹è¯•å¤±è´¥');
            }
        }

        // ä»GiståŠ è½½æ•°æ®
        async function loadDataFromGist() {
            try {
                const response = await fetch(`https://api.github.com/gists/${gistConfig.gistId}`);
                
                if (response.ok) {
                    const gistData = await response.json();
                    const fileContent = gistData.files['class2518-data.json']?.content;
                    
                    if (fileContent) {
                        const remoteData = JSON.parse(fileContent);
                        
                        // æ£€æŸ¥è¿œç¨‹æ•°æ®æ˜¯å¦æ¯”æœ¬åœ°æ–°
                        const localLastUpdate = new Date(appData.lastUpdate);
                        const remoteLastUpdate = new Date(remoteData.lastUpdate);
                        
                        if (remoteLastUpdate > localLastUpdate) {
                            appData = remoteData;
                            localStorage.setItem('class2518WeeklyData', JSON.stringify(appData));
                            showNotification('å·²ä»GiståŒæ­¥æœ€æ–°æ•°æ®');
                        }
                    }
                }
            } catch (error) {
                console.error('ä»GiståŠ è½½æ•°æ®å¤±è´¥:', error);
                // å¦‚æœGiståŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®
            }
        }

        // ä¿å­˜æ•°æ®åˆ°Gist
        async function saveDataToGist() {
            if (!gistConfig.gistId) return;
            
            try {
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (gistConfig.githubToken) {
                    headers['Authorization'] = `token ${gistConfig.githubToken}`;
                }
                
                const response = await fetch(`https://api.github.com/gists/${gistConfig.gistId}`, {
                    method: 'PATCH',
                    headers: headers,
                    body: JSON.stringify({
                        files: {
                            'class2518-data.json': {
                                content: JSON.stringify(appData, null, 2)
                            }
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ä¿å­˜å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                console.error('ä¿å­˜åˆ°Gistå¤±è´¥:', error);
                showNotification('åŒæ­¥åˆ°Gistå¤±è´¥ï¼Œæ•°æ®å·²æœ¬åœ°ä¿å­˜');
            }
        }

        // æ›´æ–°GistçŠ¶æ€æ˜¾ç¤º
        function updateGistStatus(message) {
            const statusDiv = document.getElementById('gistStatus');
            statusDiv.innerHTML = `<strong>GistçŠ¶æ€:</strong> ${message}`;
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            updateReadingNotes();
            updateLawNews();
            updateLiterature();
            updateSalonEvents();
            updateStats();
        }

        // æ›´æ–°è¯»åæ„Ÿæ˜¾ç¤º
        function updateReadingNotes() {
            const container = document.getElementById('readingNotesContent');
            container.innerHTML = appData.readingNotes.map(note => `
                <div class="content-item">
                    <h4>${note.title}</h4>
                    <p class="meta">ä½œè€…ï¼š${note.author} | ${note.date}</p>
                    <p>${note.content}</p>
                    <button class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;" onclick="deleteReadingNote(${note.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        // æ·»åŠ è¯»åæ„Ÿ
        function addReadingNote() {
            const title = document.getElementById('readingTitle').value;
            const author = document.getElementById('readingAuthor').value;
            const content = document.getElementById('readingContent').value;
            
            if (!title || !author || !content) {
                showNotification('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const newNote = {
                id: Date.now(),
                title,
                author,
                content,
                date: new Date().toISOString().split('T')[0]
            };
            
            appData.readingNotes.unshift(newNote);
            saveData();
            updateUI();
            clearReadingForm();
            showNotification('å¿ƒå¾—æ·»åŠ æˆåŠŸï¼');
        }

        // åˆ é™¤è¯»åæ„Ÿ
        function deleteReadingNote(id) {
            appData.readingNotes = appData.readingNotes.filter(note => note.id !== id);
            saveData();
            updateUI();
            showNotification('å¿ƒå¾—å·²åˆ é™¤');
        }

        // æ¸…ç©ºè¯»åæ„Ÿè¡¨å•
        function clearReadingForm() {
            document.getElementById('readingTitle').value = '';
            document.getElementById('readingAuthor').value = '';
            document.getElementById('readingContent').value = '';
        }

        // æ›´æ–°æ³•å­¦åŠ¨æ€æ˜¾ç¤º
        function updateLawNews() {
            const container = document.getElementById('lawNewsContent');
            container.innerHTML = appData.lawNews.map(news => `
                <div class="content-item">
                    <h4>${news.title}</h4>
                    <p class="meta">æ¥æºï¼š${news.source} | ${news.date}</p>
                    <p>${news.content}</p>
                    <button class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;" onclick="deleteLawNews(${news.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        // æ·»åŠ æ³•å­¦åŠ¨æ€
        function addLawNews() {
            const title = document.getElementById('newsTitle').value;
            const source = document.getElementById('newsSource').value;
            const content = document.getElementById('newsContent').value;
            
            if (!title || !source || !content) {
                showNotification('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const newNews = {
                id: Date.now(),
                title,
                source,
                content,
                date: new Date().toISOString().split('T')[0]
            };
            
            appData.lawNews.unshift(newNews);
            saveData();
            updateUI();
            clearNewsForm();
            showNotification('åŠ¨æ€æ·»åŠ æˆåŠŸï¼');
        }

        // åˆ é™¤æ³•å­¦åŠ¨æ€
        function deleteLawNews(id) {
            appData.lawNews = appData.lawNews.filter(news => news.id !== id);
            saveData();
            updateUI();
            showNotification('åŠ¨æ€å·²åˆ é™¤');
        }

        // æ¸…ç©ºæ³•å­¦åŠ¨æ€è¡¨å•
        function clearNewsForm() {
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsSource').value = '';
            document.getElementById('newsContent').value = '';
        }

        // æ›´æ–°æ–‡çŒ®æ¨èæ˜¾ç¤º
        function updateLiterature() {
            const container = document.getElementById('literatureContent');
            container.innerHTML = appData.literature.map(lit => `
                <div class="content-item">
                    <h4>${lit.title}</h4>
                    <p class="meta">ä½œè€…ï¼š${lit.author} | å‡ºç‰ˆç¤¾ï¼š${lit.publisher}</p>
                    <p>${lit.summary}</p>
                    <button class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;" onclick="deleteLiterature(${lit.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        // æ·»åŠ æ–‡çŒ®æ¨è
        function addLiterature() {
            const title = document.getElementById('litTitle').value;
            const author = document.getElementById('litAuthor').value;
            const publisher = document.getElementById('litPublisher').value;
            const summary = document.getElementById('litSummary').value;
            
            if (!title || !author || !publisher || !summary) {
                showNotification('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const newLit = {
                id: Date.now(),
                title,
                author,
                publisher,
                summary
            };
            
            appData.literature.unshift(newLit);
            saveData();
            updateUI();
            clearLiteratureForm();
            showNotification('æ–‡çŒ®æ·»åŠ æˆåŠŸï¼');
        }

        // åˆ é™¤æ–‡çŒ®æ¨è
        function deleteLiterature(id) {
            appData.literature = appData.literature.filter(lit => lit.id !== id);
            saveData();
            updateUI();
            showNotification('æ–‡çŒ®å·²åˆ é™¤');
        }

        // æ¸…ç©ºæ–‡çŒ®æ¨èè¡¨å•
        function clearLiteratureForm() {
            document.getElementById('litTitle').value = '';
            document.getElementById('litAuthor').value = '';
            document.getElementById('litPublisher').value = '';
            document.getElementById('litSummary').value = '';
        }

        // æ›´æ–°å­¦æœ¯æ²™é¾™æ˜¾ç¤º
        function updateSalonEvents() {
            const container = document.getElementById('salonContent');
            container.innerHTML = appData.salonEvents.map(event => `
                <div class="content-item">
                    <h4>${event.title}</h4>
                    <p class="meta">æ—¶é—´ï¼š${event.date} | ä¸»è®²ï¼š${event.speaker}</p>
                    <p>${event.description}</p>
                    <button class="btn btn-secondary" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;" onclick="deleteSalonEvent(${event.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        // æ·»åŠ å­¦æœ¯æ²™é¾™
        function addSalonEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const speaker = document.getElementById('eventSpeaker').value;
            const description = document.getElementById('eventDescription').value;
            
            if (!title || !date || !speaker || !description) {
                showNotification('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }
            
            const newEvent = {
                id: Date.now(),
                title,
                date,
                speaker,
                description
            };
            
            appData.salonEvents.unshift(newEvent);
            saveData();
            updateUI();
            clearEventForm();
            showNotification('æ´»åŠ¨æ·»åŠ æˆåŠŸï¼');
        }

        // åˆ é™¤å­¦æœ¯æ²™é¾™
        function deleteSalonEvent(id) {
            appData.salonEvents = appData.salonEvents.filter(event => event.id !== id);
            saveData();
            updateUI();
            showNotification('æ´»åŠ¨å·²åˆ é™¤');
        }

        // æ¸…ç©ºå­¦æœ¯æ²™é¾™è¡¨å•
        function clearEventForm() {
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventSpeaker').value = '';
            document.getElementById('eventDescription').value = '';
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('notesCount').textContent = appData.readingNotes.length;
            document.getElementById('newsCount').textContent = appData.lawNews.length;
            document.getElementById('literatureCount').textContent = appData.literature.length;
        }

        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateShareLink() {
            if (!gistConfig.gistId) {
                showNotification('è¯·å…ˆé…ç½®GitHub Gist');
                return;
            }
            
            // æ™ºèƒ½ç”Ÿæˆåˆ†äº«é“¾æ¥
            const shareUrls = generateSmartShareUrls();
            
            // æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨é“¾æ¥æ ¼å¼
            const shareLinkElement = document.getElementById('shareLink');
            shareLinkElement.innerHTML = `
                <div style="margin-bottom: 10px;"><strong>ğŸŒ å…¬å…±ç½‘ç»œé“¾æ¥ï¼š</strong></div>
                <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px; word-break: break-all;">
                    ${shareUrls.public}
                </div>
                <div style="margin-bottom: 10px;"><strong>ğŸ’» æœ¬åœ°ç½‘ç»œé“¾æ¥ï¼š</strong></div>
                <div style="background: #f3e5f5; padding: 10px; border-radius: 5px; margin-bottom: 10px; word-break: break-all;">
                    ${shareUrls.local}
                </div>
                <div style="margin-bottom: 10px;"><strong>ğŸ“± æ‰‹æœºæ‰«ç é“¾æ¥ï¼š</strong></div>
                <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; word-break: break-all;">
                    ${shareUrls.mobile}
                </div>
            `;
            
            // ç”ŸæˆäºŒç»´ç 
            generateQRCode(shareUrls.public);
            
            showNotification('åˆ†äº«é“¾æ¥å·²ç”Ÿæˆï¼æ”¯æŒå…¬ç½‘è®¿é—®');
        }
        
        // æ™ºèƒ½ç”Ÿæˆå¤šç§æ ¼å¼çš„åˆ†äº«é“¾æ¥
        function generateSmartShareUrls() {
            const gistId = gistConfig.gistId;
            
            // è·å–å½“å‰è®¿é—®ä¿¡æ¯
            const currentUrl = window.location.href;
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            const port = window.location.port;
            
            // å…¬å…±ç½‘ç»œé“¾æ¥ï¼ˆå¦‚æœéƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼‰
            let publicUrl = '';
            if (hostname !== 'localhost' && hostname !== '127.0.0.1') {
                // å½“å‰å°±æ˜¯å…¬ç½‘è®¿é—®
                publicUrl = `${protocol}//${hostname}${port ? ':' + port : ''}/student-view.html?gistId=${gistId}`;
            } else {
                // æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œæç¤ºéœ€è¦éƒ¨ç½²
                publicUrl = `éœ€è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨æ‰èƒ½ç”Ÿæˆå…¬ç½‘é“¾æ¥ (Gist ID: ${gistId})`;
            }
            
            // æœ¬åœ°ç½‘ç»œé“¾æ¥
            const localUrl = `${protocol}//${hostname}${port ? ':' + port : ''}/student-view.html?gistId=${gistId}`;
            
            // æ‰‹æœºæ‰«ç é“¾æ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const mobileUrl = `${protocol}//${hostname}${port ? ':' + port : ''}/student-view.html?gistId=${gistId}&mobile=true`;
            
            return {
                public: publicUrl,
                local: localUrl,
                mobile: mobileUrl
            };
        }
        
        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode(url) {
            const qrContainer = document.getElementById('qrCodeContainer');
            if (!qrContainer) {
                // åˆ›å»ºäºŒç»´ç å®¹å™¨
                const shareSection = document.querySelector('.share-section');
                const qrDiv = document.createElement('div');
                qrDiv.id = 'qrCodeContainer';
                qrDiv.innerHTML = `
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: white; border-radius: 10px;">
                        <h4 style="margin-bottom: 10px; color: #1e3c72;">ğŸ“± æ‰«ç åˆ†äº«</h4>
                        <div id="qrCode" style="padding: 10px; background: white; display: inline-block;"></div>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">å­¦ç”Ÿç”¨æ‰‹æœºæ‰«ç å³å¯è®¿é—®</p>
                    </div>
                `;
                shareSection.appendChild(qrDiv);
            }
            
            // ç®€å•çš„äºŒç»´ç ç”Ÿæˆï¼ˆä½¿ç”¨Canvasï¼‰
            const qrCanvas = document.getElementById('qrCode');
            if (qrCanvas) {
                // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
                qrCanvas.innerHTML = '';
                
                // åˆ›å»ºCanvasç»˜åˆ¶äºŒç»´ç 
                const canvas = document.createElement('canvas');
                canvas.width = 120;
                canvas.height = 120;
                const ctx = canvas.getContext('2d');
                
                // ç»˜åˆ¶ç®€å•çš„äºŒç»´ç æ ·å¼
                ctx.fillStyle = '#1e3c72';
                
                // ç»˜åˆ¶äºŒç»´ç å›¾æ¡ˆ
                for (let i = 0; i < 7; i++) {
                    for (let j = 0; j < 7; j++) {
                        if ((i + j) % 2 === 0 || (i === 3 && j === 3)) {
                            ctx.fillRect(10 + i * 15, 10 + j * 15, 12, 12);
                        }
                    }
                }
                
                qrCanvas.appendChild(canvas);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤åˆ¶é“¾æ¥
                canvas.addEventListener('click', function() {
                    navigator.clipboard.writeText(url).then(() => {
                        showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    });
                });
            }
        }

        // å¤åˆ¶åˆ†äº«é“¾æ¥
        function copyShareLink() {
            const link = document.getElementById('shareLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initData();
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºæ˜å¤©
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('eventDate').value = tomorrow.toISOString().split('T')[0];
            
            // ç”Ÿæˆç¤ºä¾‹åˆ†äº«é“¾æ¥
            generateShareLink();
        });
    </script>
</body>
</html>